import{ref as e,computed as t,resolveComponent as l,openBlock as n,createElementBlock as a,Fragment as i,createCommentVNode as o,createVNode as r,withCtx as s,normalizeClass as c,createBlock as d,createElementVNode as u,renderList as p,toDisplayString as m,createTextVNode as f}from"vue";import{useApi as v,useStores as y}from"@directus/extensions-sdk";var h={props:{disabled:{type:Boolean,default:!1},collection:{type:String,required:!0},field:{type:String,required:!0},value:{type:[String,Number],default:null},placeholder:{type:String,default:"Select an item"},template:{type:String,default:"name"},filter:{type:Object,default:null}},emits:["input"],setup(l,{emit:n}){const a=v(),{useCollectionsStore:i,useRelationsStore:o,useFieldsStore:r}=y(),s=i(),c=o(),d=r(),{relatedCollection:u}=function(){const e=t((()=>c.getRelationsForField(l.collection,l.field)?.[0]));return{relatedCollection:t((()=>e.value?.related_collection?s.getCollection(e.value.related_collection):null))}}(),p=l.template.replace("{{","").replace("}}",""),m=d.getPrimaryKeyFieldForCollection(u.value.collection);var f=!1;const h=e([]),b=e("");async function g(){try{const e=await a.get(`/items/${u.value.collection}`,{params:{limit:-1,filter:l.filter,search:b.value&&b.value!=l.value?b.value:""}});if(h.value=e.data.data,null!=l.value&&""==b.value){const e=await a.get(`/items/${u.value.collection}/${l.value}`);b.value=_(e.data.data)}}catch(e){console.warn(e)}}return g(),{results:h,setDropdown:function(e){null==e?(b.value=e,l.value=e,n("input",e)):(b.value=_(e),l.value=e[m.field],n("input",e[m.field]));g()},searchQuery:b,displayField:p,onInput:function(){f||setTimeout((()=>{g(),f=!1}),500);f=!0},primaryKey:m,outputFields:_};function _(e){var t=l.template,n="";return Object.keys(e).forEach((l=>{n="{{"+l+"}}",t=t.replace(n,e[l])})),t}}};const b=f("Deselect"),g={class:"item-text"};var _=[],w=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,n=!0===t.prepend?"prepend":"append",a=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(a){var o=_.indexOf(i);-1===o&&(o=_.push(i)-1,w[o]={}),l=w[o]&&w[o][n]?w[o][n]:w[o][n]=r()}else l=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),a=0;a<l.length;a++)e.setAttribute(l[a],t.attributes[l[a]]);var o="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(o,e),e}}("\n.content .list li[data-v-64969d30]:hover {\n\t\tcursor: pointer;\n}\n",{}),h.render=function(e,t,f,v,y,h){const _=l("v-icon"),w=l("v-input"),k=l("v-list-item-content"),S=l("v-list-item-icon"),C=l("v-list-item"),F=l("v-divider"),x=l("v-list"),D=l("v-menu");return n(),a(i,null,[o(' <v-notice v-if="results.length == 0" type="info">\n\t\tLoading&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<v-progress-circular indeterminate />\n\t</v-notice> '),r(D,{attached:"",disabled:f.disabled,"close-on-content-click":!0},{activator:s((({active:e,activate:l})=>[r(w,{modelValue:v.searchQuery,"onUpdate:modelValue":[t[1]||(t[1]=e=>v.searchQuery=e),v.onInput],disabled:f.disabled,placeholder:f.placeholder,class:c({"has-value":f.value}),nullable:!1,onFocus:l},{append:s((()=>[null!==f.value?(n(),d(_,{key:0,clickable:"",name:"close",onClick:t[0]||(t[0]=e=>v.setDropdown(null))})):(n(),d(_,{key:1,clickable:"",name:"expand_more",class:c(["open-indicator",{open:e}]),onClick:l},null,8,["class","onClick"]))])),_:2},1032,["modelValue","disabled","placeholder","class","onFocus","onUpdate:modelValue"])])),default:s((()=>[u("div",{class:c(["content",e.width])},[r(x,{class:"list"},{default:s((()=>[u("template",null,[r(C,{onClick:t[2]||(t[2]=t=>e.$emit("input",null)),disabled:null===f.value},{default:s((()=>[r(k,null,{default:s((()=>[b])),_:1}),r(S,null,{default:s((()=>[r(_,{name:"close"})])),_:1})])),_:1},8,["disabled"]),r(F)]),(n(!0),a(i,null,p(v.results,((e,t)=>(n(),d(C,{key:e[v.primaryKey.field]+t,active:f.value===e[v.primaryKey.field],disabled:e.disabled,onClick:t=>v.setDropdown(e)},{default:s((()=>[r(k,null,{default:s((()=>[u("span",g,m(v.outputFields(e)),1)])),_:2},1024)])),_:2},1032,["active","disabled","onClick"])))),128))])),_:1})],2)])),_:1},8,["disabled"])],2112)},h.__scopeId="data-v-64969d30",h.__file="src/interface.vue";var k={id:"select-dropdown-m2o-search",name:"M2O Dropdown with Search",icon:"arrow_drop_down_circle",description:"Show options from API",component:h,types:["uuid","string","text","integer","bigInteger"],localTypes:["m2o"],group:"relational",relational:!0,options:({relations:e})=>{const t=e.m2o?.related_collection;return console.log(t),[{field:"template",name:"Field to Show",meta:{interface:"system-display-template",options:{collectionName:t},width:"half"}},{field:"placeholder",type:"string",name:"Placeholder",meta:{interface:"input",width:"half",options:{placeholder:"Enter a placeholder"}}},{field:"filter",name:"$t:filter",type:"json",meta:{interface:"system-filter",options:{collectionName:t}}}]},recommendedDisplays:["related-values"]};export{k as default};
